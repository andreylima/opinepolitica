jQuery(document).ready(function(){function n(){var t={zoom:13,center:new google.maps.LatLng(-18.8595948,-41.9529012)};e=new google.maps.Map(document.getElementById("mapagv"),t);e.setOptions(t);a(e)}function r(){var t=google.maps.Animation.BOUNCE;var n=new google.maps.LatLng(-18.8595948,-41.9529012);var r={zoom:13,center:n,scrollwheel:false};e=new google.maps.Map(document.getElementById("mapagv-register"),r);marker=new google.maps.Marker({map:e,draggable:true,animation:t,position:n});var i=jQuery(".search-adress")[0];var o={componentRestrictions:{country:"br"}};var u=new google.maps.places.Autocomplete(i,o);u.bindTo("br",e);google.maps.event.addListener(u,"place_changed",function(){s(u.getPlace().geometry.location);if(marker){e.setCenter(u.getPlace().geometry.location);e.setZoom(14);marker.setPosition(u.getPlace().geometry.location)}});google.maps.event.addListener(marker,"dragend",function(){s(marker.position);marker.setAnimation(null)})}function i(){var t={zoom:13,center:new google.maps.LatLng(-18.8595948,-41.9529012)};e=new google.maps.Map(document.getElementById("map-single"),t);e.setOptions(t);f(e)}function c(e,t){var n=[];var r;l=[];var i=jQuery("#denuncias_list");i.html("");for(var s=0,o=e.length;s<o;s++){var u=e[s];var a=u.situacao_denuncia=="resolvida"?"pin_2":"pin_1";var f=u.situacao_denuncia=="resolvida"?"Resolvida":"Não Resolvida";marker=new google.maps.Marker({position:new google.maps.LatLng(u.latitude,u.longitude),map:t,icon:templateDir+"/assets/img/"+a+".png"});var c=u.link_video.split("=");var c=c[1];var p=u.data.split("/"),d=[p[1],p[0],p[2]],v=new google.maps.InfoWindow({maxWidth:300}),m='<div class="hc-info-window">'+'<h4 class="hc-info-title"><a  href="'+u.permalink+'">'+u.titulo+"</a></h4>"+'<span class="flaticon-pin56 local-denuncia">&nbsp;'+u.local_denuncia+"</span>"+'<iframe id="link_video" style="width:300px;height:215px;background-color:black"  src="//www.youtube.com/embed/'+c+'" frameborder="0" allowfullscreen ALT="carregando video"></iframe>'+'<div class="hc-info-box">'+'<label for="data-denuncia">Data da Denúncia:</label>'+'<h6 class="flaticon-calendar146 data-denuncia">&nbsp;'+d.join("/")+"</h6>"+'<label for="situacao_denuncia" class="situacao-label">Situação:</label>'+'<input type="text" name="situacao_denuncia" value="'+f+'" id="situacao_denuncia" disabled>'+'<a  href="'+u.permalink+'" class="qtd-comments-denuncia" ><div class="flaticon-comments16 ">'+u.qtd_comments_denuncia+"</div></a>"+'<a href="'+u.permalink+'" class="button-info-denuncia">+ Ver Comentários</a></div>'+"</div>";l.push(marker);v.setContent(m);n.push(v);google.maps.event.addListener(marker,"click",function(e,r){return function(){n.map(function(e,t,n){e.close()});n[l.indexOf(e)].open(t,e)}}(marker,r));var g=h(u,p,s);i.append(g);jQuery(".list_lines").on("click",function(e){var t=jQuery(this),n=t.data("index");console.log(n);google.maps.event.trigger(l[n],"click")})}}function d(t){p=[];for(var n=0,r=o.length;n<r;n++){var i=o[n];if(i.bairro_denuncia==t){p.push(i)}}v(null);c(p,e)}function v(e){for(var t=0;t<l.length;t++){l[t].setMap(e)}}function m(){v(null)}function g(){v(null);l=o;c(l,e)}var e;var t;google.maps.event.addDomListener(window,"load",n);google.maps.event.addDomListener(window,"load",r);google.maps.event.addDomListener(window,"load",i);var s=function(t){var n;var r=null;geocoder=new google.maps.Geocoder;geocoder.geocode({latLng:t},function(t,i){if(i==google.maps.GeocoderStatus.OK){if(e){jQuery("#lat").val(t[0].geometry.location.lat());jQuery("#lng").val(t[0].geometry.location.lng());jQuery("#addressField").val(t[0].formatted_address);jQuery(".active-adress").addClass("active").html('<span class="icon map-marker"></span> &nbsp;'+t[0].formatted_address)}var s=t[0].address_components;jQuery.each(s,function(e,t){if(t.types[0]=="locality")n=t.long_name;jQuery("#city").val(n)});r=t[0].address_components[2].long_name;if(r==n)r=t[0].address_components[3].long_name;var o=jQuery("#state-name").val();if(r==o)r=null;if(r)jQuery("#denuncia_bairro").val(r)}else jQuery("#dragMap").append("Não foi possível determinar sua localização"+i)})};var o=[];var u;var a=function(e){jQuery.ajax({type:"POST",url:myAjax.ajaxurl,data:"action=get_denuncias",success:function(t){t=JSON.parse(t);o=t;c(t,e)}})};var f=function(e){jQuery.ajax({type:"POST",url:myAjax.ajaxurl,data:"action=get_denuncia",success:function(t){t=JSON.parse(t);o=t;c(t,e)}})};var l=[];var h=function(e,t,n){orderedDate=[t[1],t[0],t[2]];var r='<li><a class="list_lines" data-index="'+n+'">'+'<div class="">'+"<h4>"+e.titulo+"</h4>"+"<h5>"+e.local_denuncia+"</h5>"+'<h5><i class="icon-calendar"></i>'+orderedDate.join("/")+"</h5>"+"</div>"+"</a></li>";return r};var p=[];jQuery("#bairro_denuncia").change(function(){if(this.value==""){g()}else{d(this.value)}});jQuery("#show_all").click(function(){g()})})