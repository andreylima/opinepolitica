
//google maps api

jQuery(document).ready(function(){

var map;
function initialize() {
  var mapOptions = {
    zoom: 13,
    center: new google.maps.LatLng(-18.8595948, -41.9529012)
  };
  map = new google.maps.Map(document.getElementById('mapagv'),
      mapOptions);
}

google.maps.event.addDomListener(window, 'load', initialize);


var map2;
function initialize2() {

var animation = google.maps.Animation.BOUNCE;
var position = new google.maps.LatLng(-18.8595948, -41.9529012);
  var mapOptions = {
    zoom: 13,
    center: position,
    scrollwheel: false,

  };
  map = new google.maps.Map(document.getElementById('mapagv-register'),
      mapOptions);

  marker = new google.maps.Marker({
      map:map,
      draggable: true,
      animation: animation,
      position: position
  });

    var $addressInput = jQuery('.search-adress')[0];
  var searchOptions = {
    componentRestrictions: {country: 'br'}
  };

  var autoComplete = new google.maps.places.Autocomplete($addressInput, searchOptions);
  autoComplete.bindTo('br', map);

  google.maps.event.addListener(autoComplete, 'place_changed', function() {
    geocodePosition(autoComplete.getPlace().geometry.location);
    if(marker) {
      map.setCenter(autoComplete.getPlace().geometry.location);
      map.setZoom(14);
      marker.setPosition(autoComplete.getPlace().geometry.location);
    }
  });

  google.maps.event.addListener(marker, 'dragend', function(){
    geocodePosition(marker.position);
    marker.setAnimation(null);
  });

}

google.maps.event.addDomListener(window, 'load', initialize2);


var geocodePosition = function(pos){
  var city;
  var bairro = null;
  geocoder = new google.maps.Geocoder();
  geocoder.geocode({
      latLng: pos
  },function(results, status) {
    if (status == google.maps.GeocoderStatus.OK){
      if(map){
        jQuery('#lat').val(results[0].geometry.location.lat());
        jQuery('#lng').val(results[0].geometry.location.lng());
       	jQuery('#addressField').val(results[0].formatted_address);
        jQuery('.active-adress').addClass('active').html('<span class="icon map-marker"></span> &nbsp;'+results[0].formatted_address);
      }

      var arrAddress = results[0].address_components;
      jQuery.each(arrAddress, function (i, address_component) {
        if (address_component.types[0] == "locality")  //"route", "country", "postal_code_prefix", "street_number"
            city = address_component.long_name;
            jQuery('#city').val(city);
      });

      bairro = results[0].address_components[2].long_name;
      if(bairro == city)
        bairro = results[0].address_components[3].long_name;

      var estado = jQuery('#state-name').val();
      if(bairro == estado)
        bairro = null;

      if(bairro)
        jQuery('#denuncia_bairro').val(bairro);
    }else
      jQuery("#dragMap").append('Não foi possível determinar sua localização'+status);
  });
}










});