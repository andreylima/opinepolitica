jQuery(document).ready(function(){function a(){var a={zoom:13,center:new google.maps.LatLng(-18.8595948,-41.9529012),maxWidth:500};c=new google.maps.Map(document.getElementById("mapagv"),a),c.setOptions(a),m(c)}function e(){var a=google.maps.Animation.BOUNCE,e=new google.maps.LatLng(-18.8595948,-41.9529012),o={zoom:13,center:e,scrollwheel:!1};c=new google.maps.Map(document.getElementById("mapagv-register"),o),marker=new google.maps.Marker({map:c,draggable:!0,animation:a,position:e});var n=jQuery(".search-adress")[0],l={componentRestrictions:{country:"br"}},t=new google.maps.places.Autocomplete(n,l);t.bindTo("br",c),google.maps.event.addListener(t,"place_changed",function(){s(t.getPlace().geometry.location),marker&&(c.setCenter(t.getPlace().geometry.location),c.setZoom(14),marker.setPosition(t.getPlace().geometry.location))}),google.maps.event.addListener(marker,"dragend",function(){s(marker.position),marker.setAnimation(null)})}function o(){var a={zoom:13,center:new google.maps.LatLng(-18.8595948,-41.9529012),scrollwheel:!1};c=new google.maps.Map(document.getElementById("map-single"),a),c.setOptions(a),d(c)}function n(a,e){var o,n=[];g=[];var l=jQuery("#reclamacao_list");l.html("");for(var t=0,r=a.length;r>t;t++){var c=a[t],s="resolvida"==c.situacao_reclamacao?"pin_2":"pin_1",i="resolvida"==c.situacao_reclamacao?"Resolvida":"Não Resolvida";marker=new google.maps.Marker({position:new google.maps.LatLng(c.latitude,c.longitude),map:e,icon:templateDir+"/assets/img/"+s+".png"});var m=c.data.split("/"),d=[m[1],m[0],m[2]],p=new google.maps.InfoWindow({maxWidth:300}),v='<div class="hc-info-window"><h4 class="hc-info-title"><a  href="'+c.permalink+'">'+c.titulo+'</a></h4><a  href="'+c.permalink+'"><span class="flaticon-pin56 local-reclamacao">&nbsp;'+c.local_reclamacao+'</span></a><a  href="'+c.permalink+'" class="image-reclam-link"><img src="'+c.link_imagem+'" alt="'+c.titulo+'" class="imagem-reclamacao"></a><div class="hc-info-box"><label for="data-reclamacao">Data da Reclamação:</label><h6 class="flaticon-calendar146 data-reclamacao">&nbsp;'+d.join("/")+'</h6><label for="situacao_reclamacao" class="situacao-label">Situação:</label><input type="text" name="situacao_reclamacao" value="'+i+'" id="situacao_reclamacao" disabled><a  href="'+c.permalink+'" class="qtd-comments-reclamacao" ><div class="flaticon-comments16 ">'+c.qtd_comments_reclamacao+'</div></a><a href="'+c.permalink+'" class="button-info-reclamacao">+ Ver Comentários</a></div></div>';g.push(marker),p.setContent(v),n.push(p),google.maps.event.addListener(marker,"click",function(a){return function(){n.map(function(a){a.close()}),n[g.indexOf(a)].open(e,a)}}(marker,o));var f=u(c,m,t);l.append(f),jQuery(".list_lines").on("click",function(){var a=jQuery(this),e=a.data("index");console.log(e),google.maps.event.trigger(g[e],"click")})}}function l(a){p=[];for(var e=0,o=i.length;o>e;e++){var l=i[e];l.bairro_reclamacao==a&&p.push(l)}t(null),n(p,c)}function t(a){for(var e=0;e<g.length;e++)g[e].setMap(a)}function r(){t(null),g=i,n(g,c)}var c;google.maps.event.addDomListener(window,"load",a),google.maps.event.addDomListener(window,"load",e),google.maps.event.addDomListener(window,"load",o);var s=function(a){var e,o=null;geocoder=new google.maps.Geocoder,geocoder.geocode({latLng:a},function(a,n){if(n==google.maps.GeocoderStatus.OK){c&&(jQuery("#lat").val(a[0].geometry.location.lat()),jQuery("#lng").val(a[0].geometry.location.lng()),jQuery("#addressField").val(a[0].formatted_address),jQuery(".active-adress").addClass("active").html('<span class="icon map-marker"></span> &nbsp;'+a[0].formatted_address));var l=a[0].address_components;jQuery.each(l,function(a,o){"locality"==o.types[0]&&(e=o.long_name),jQuery("#city").val(e)}),o=a[0].address_components[2].long_name,o==e&&(o=a[0].address_components[3].long_name);var t=jQuery("#state-name").val();o==t&&(o=null),o&&jQuery("#reclamacao_bairro").val(o)}else jQuery("#dragMap").append("Não foi possível determinar sua localização"+n)})},i=[],m=function(a){jQuery.ajax({type:"POST",url:myAjax.ajaxurl,data:"action=get_reclamacoes",success:function(e){e=JSON.parse(e),i=e,n(e,a)}})},d=function(a){jQuery.ajax({type:"POST",url:myAjax.ajaxurl,data:"action=get_reclamacao",success:function(e){e=JSON.parse(e),i=e,n(e,a)}})},g=[],u=function(a,e,o){orderedDate=[e[1],e[0],e[2]];var n='<li><a class="list_lines" data-index="'+o+'"><div class=""><h4>'+a.titulo+"</h4><h5>"+a.local_reclamacao+'</h5><h5><i class="icon-calendar"></i>'+orderedDate.join("/")+"</h5></div></a></li>";return n},p=[];jQuery("#bairro_reclamacao").change(function(){""==this.value?r():l(this.value)}),jQuery("#show_all").click(function(){r()})});